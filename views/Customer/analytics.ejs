<%- include('partials/header') %>
  <link rel="stylesheet" href="/css/customer/dashboard.css">
  </head>

  <body>
    <div class="dash-wrapper">
      <%- include('partials/sidebar', { activePage: 'analytics' , user: user, stats: stats }) %>

        <main class="dash-main">
          <%- include('partials/topbar', { pageTitle: 'Analytics' , notifications: notifications, website: website }) %>

            <div class="dash-content">
              <!-- Page Header -->
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div>
                  <h2
                    style="font-size: 1.5rem; font-weight: 700; color: var(--dash-text-primary); margin-bottom: 0.25rem;">
                    Analytics Overview</h2>
                  <p style="color: var(--dash-text-muted); font-size: 0.9rem;">Track your store's performance and growth
                  </p>
                </div>
                <div style="display: flex; gap: 0.75rem;">
                  <select class="filter-select" style="padding: 0.6rem 2rem 0.6rem 1rem;">
                    <option>Last 7 days</option>
                    <option>Last 30 days</option>
                    <option>Last 90 days</option>
                    <option>This year</option>
                  </select>
                  <button class="dash-btn dash-btn-secondary">
                    <i data-lucide="download"></i>
                    Export
                  </button>
                </div>
              </div>

              <!-- Stats Grid -->
              <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card blue">
                  <div class="stat-icon">
                    <i data-lucide="users"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-value">
                      <%= stats.totalVisitors.toLocaleString() %>
                    </div>
                    <div class="stat-label">Total Visitors</div>
                    <div class="stat-change positive">
                      <i data-lucide="trending-up"></i>
                      +<%= stats.visitorsGrowth %>%
                    </div>
                  </div>
                </div>
                <div class="stat-card green">
                  <div class="stat-icon">
                    <i data-lucide="eye"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-value">45,230</div>
                    <div class="stat-label">Page Views</div>
                    <div class="stat-change positive">
                      <i data-lucide="trending-up"></i>
                      +18.3%
                    </div>
                  </div>
                </div>
                <div class="stat-card purple">
                  <div class="stat-icon">
                    <i data-lucide="percent"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-value">
                      <%= stats.conversionRate %>%
                    </div>
                    <div class="stat-label">Conversion Rate</div>
                    <div class="stat-change <%= stats.conversionGrowth >= 0 ? 'positive' : 'negative' %>">
                      <i data-lucide="<%= stats.conversionGrowth >= 0 ? 'trending-up' : 'trending-down' %>"></i>
                      <%= stats.conversionGrowth>= 0 ? '+' : '' %><%= stats.conversionGrowth %>%
                    </div>
                  </div>
                </div>
                <div class="stat-card orange">
                  <div class="stat-icon">
                    <i data-lucide="clock"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-value">4:32</div>
                    <div class="stat-label">Avg. Session</div>
                    <div class="stat-change positive">
                      <i data-lucide="trending-up"></i>
                      +5.7%
                    </div>
                  </div>
                </div>
              </div>

              <!-- Main Charts -->
              <div class="charts-grid" style="margin-bottom: 2rem;">
                <!-- Traffic Chart -->
                <div class="chart-card">
                  <div class="chart-card-header">
                    <h3 class="chart-card-title">
                      <i data-lucide="activity"></i>
                      Traffic Overview
                    </h3>
                    <div class="chart-card-actions">
                      <button class="chart-filter-btn active">Visitors</button>
                      <button class="chart-filter-btn">Page Views</button>
                    </div>
                  </div>
                  <div class="chart-card-body">
                    <div class="chart-container">
                      <canvas id="trafficChart"></canvas>
                    </div>
                  </div>
                </div>

                <!-- Traffic Sources -->
                <div class="chart-card">
                  <div class="chart-card-header">
                    <h3 class="chart-card-title">
                      <i data-lucide="pie-chart"></i>
                      Traffic Sources
                    </h3>
                  </div>
                  <div class="chart-card-body">
                    <div class="chart-container">
                      <canvas id="sourcesChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Secondary Charts -->
              <div class="charts-grid" style="margin-bottom: 2rem;">
                <!-- Device Breakdown -->
                <div class="chart-card">
                  <div class="chart-card-header">
                    <h3 class="chart-card-title">
                      <i data-lucide="smartphone"></i>
                      Device Breakdown
                    </h3>
                  </div>
                  <div class="chart-card-body">
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                      <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--dash-bg-tertiary); border-radius: var(--dash-radius-md);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                          <div
                            style="width: 40px; height: 40px; background: var(--dash-bg-accent); border-radius: var(--dash-radius-sm); display: flex; align-items: center; justify-content: center; color: var(--dash-primary);">
                            <i data-lucide="monitor"></i>
                          </div>
                          <span style="font-weight: 600; color: var(--dash-text-primary);">Desktop</span>
                        </div>
                        <div style="text-align: right;">
                          <div style="font-weight: 700; color: var(--dash-text-primary);">58%</div>
                          <div style="font-size: 0.8rem; color: var(--dash-text-muted);">7,241 users</div>
                        </div>
                      </div>
                      <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--dash-bg-tertiary); border-radius: var(--dash-radius-md);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                          <div
                            style="width: 40px; height: 40px; background: rgba(16, 185, 129, 0.12); border-radius: var(--dash-radius-sm); display: flex; align-items: center; justify-content: center; color: var(--dash-success);">
                            <i data-lucide="smartphone"></i>
                          </div>
                          <span style="font-weight: 600; color: var(--dash-text-primary);">Mobile</span>
                        </div>
                        <div style="text-align: right;">
                          <div style="font-weight: 700; color: var(--dash-text-primary);">35%</div>
                          <div style="font-size: 0.8rem; color: var(--dash-text-muted);">4,358 users</div>
                        </div>
                      </div>
                      <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--dash-bg-tertiary); border-radius: var(--dash-radius-md);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                          <div
                            style="width: 40px; height: 40px; background: rgba(245, 158, 11, 0.12); border-radius: var(--dash-radius-sm); display: flex; align-items: center; justify-content: center; color: var(--dash-warning);">
                            <i data-lucide="tablet"></i>
                          </div>
                          <span style="font-weight: 600; color: var(--dash-text-primary);">Tablet</span>
                        </div>
                        <div style="text-align: right;">
                          <div style="font-weight: 700; color: var(--dash-text-primary);">7%</div>
                          <div style="font-size: 0.8rem; color: var(--dash-text-muted);">871 users</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Top Pages -->
                <div class="chart-card">
                  <div class="chart-card-header">
                    <h3 class="chart-card-title">
                      <i data-lucide="file-text"></i>
                      Top Pages
                    </h3>
                  </div>
                  <div class="chart-card-body" style="padding: 0;">
                    <table style="width: 100%; border-collapse: collapse;">
                      <thead>
                        <tr>
                          <th
                            style="padding: 1rem 1.5rem; text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--dash-text-muted); text-transform: uppercase; background: var(--dash-bg-tertiary);">
                            Page</th>
                          <th
                            style="padding: 1rem 1.5rem; text-align: right; font-size: 0.75rem; font-weight: 600; color: var(--dash-text-muted); text-transform: uppercase; background: var(--dash-bg-tertiary);">
                            Views</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td
                            style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--dash-border-light); color: var(--dash-text-primary);">
                            /</td>
                          <td
                            style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--dash-border-light); text-align: right; font-weight: 600; color: var(--dash-text-primary);">
                            12,450</td>
                        </tr>
                        <tr>
                          <td
                            style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--dash-border-light); color: var(--dash-text-primary);">
                            /products</td>
                          <td
                            style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--dash-border-light); text-align: right; font-weight: 600; color: var(--dash-text-primary);">
                            8,234</td>
                        </tr>
                        <tr>
                          <td
                            style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--dash-border-light); color: var(--dash-text-primary);">
                            /products/brake-pads</td>
                          <td
                            style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--dash-border-light); text-align: right; font-weight: 600; color: var(--dash-text-primary);">
                            5,678</td>
                        </tr>
                        <tr>
                          <td
                            style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--dash-border-light); color: var(--dash-text-primary);">
                            /cart</td>
                          <td
                            style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--dash-border-light); text-align: right; font-weight: 600; color: var(--dash-text-primary);">
                            3,456</td>
                        </tr>
                        <tr>
                          <td style="padding: 1rem 1.5rem; color: var(--dash-text-primary);">/checkout</td>
                          <td
                            style="padding: 1rem 1.5rem; text-align: right; font-weight: 600; color: var(--dash-text-primary);">
                            1,890</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <!-- Geographic Data -->
              <div class="chart-card">
                <div class="chart-card-header">
                  <h3 class="chart-card-title">
                    <i data-lucide="globe"></i>
                    Top Countries
                  </h3>
                </div>
                <div class="chart-card-body">
                  <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1.5rem;">
                    <div
                      style="text-align: center; padding: 1.5rem; background: var(--dash-bg-tertiary); border-radius: var(--dash-radius-lg);">
                      <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ‡ºðŸ‡¸</div>
                      <div style="font-weight: 700; color: var(--dash-text-primary); font-size: 1.25rem;">45%</div>
                      <div style="font-size: 0.85rem; color: var(--dash-text-muted);">United States</div>
                    </div>
                    <div
                      style="text-align: center; padding: 1.5rem; background: var(--dash-bg-tertiary); border-radius: var(--dash-radius-lg);">
                      <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ‡¬ðŸ‡§</div>
                      <div style="font-weight: 700; color: var(--dash-text-primary); font-size: 1.25rem;">18%</div>
                      <div style="font-size: 0.85rem; color: var(--dash-text-muted);">United Kingdom</div>
                    </div>
                    <div
                      style="text-align: center; padding: 1.5rem; background: var(--dash-bg-tertiary); border-radius: var(--dash-radius-lg);">
                      <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ‡¨ðŸ‡¦</div>
                      <div style="font-weight: 700; color: var(--dash-text-primary); font-size: 1.25rem;">12%</div>
                      <div style="font-size: 0.85rem; color: var(--dash-text-muted);">Canada</div>
                    </div>
                    <div
                      style="text-align: center; padding: 1.5rem; background: var(--dash-bg-tertiary); border-radius: var(--dash-radius-lg);">
                      <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ‡©ðŸ‡ª</div>
                      <div style="font-weight: 700; color: var(--dash-text-primary); font-size: 1.25rem;">10%</div>
                      <div style="font-size: 0.85rem; color: var(--dash-text-muted);">Germany</div>
                    </div>
                    <div
                      style="text-align: center; padding: 1.5rem; background: var(--dash-bg-tertiary); border-radius: var(--dash-radius-lg);">
                      <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ‡¦ðŸ‡º</div>
                      <div style="font-weight: 700; color: var(--dash-text-primary); font-size: 1.25rem;">8%</div>
                      <div style="font-size: 0.85rem; color: var(--dash-text-muted);">Australia</div>
                    </div>
                  </div>
                </div>
              </div>

              <%- include('partials/footer') %>

                <script>
                  // Traffic Chart
                  const trafficCtx = document.getElementById('trafficChart').getContext('2d');
                  new Chart(trafficCtx, {
                    type: 'line',
                    data: {
                      labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                      datasets: [{
                        label: 'Visitors',
                        data: [1850, 2100, 1950, 2300, 2150, 1800, 2400],
                        borderColor: '#6366F1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#6366F1',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                      }, {
                        label: 'Page Views',
                        data: [4200, 4800, 4400, 5100, 4900, 4100, 5500],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#10B981',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                      }]
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: {
                          position: 'top',
                          align: 'end'
                        }
                      },
                      scales: {
                        y: {
                          beginAtZero: true,
                          grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                          grid: { display: false }
                        }
                      }
                    }
                  });

                  // Sources Chart
                  const sourcesCtx = document.getElementById('sourcesChart').getContext('2d');
                  new Chart(sourcesCtx, {
                    type: 'doughnut',
                    data: {
                      labels: ['Organic Search', 'Direct', 'Social Media', 'Referral', 'Email'],
                      datasets: [{
                        data: [42, 28, 15, 10, 5],
                        backgroundColor: ['#6366F1', '#10B981', '#F59E0B', '#EC4899', '#06B6D4'],
                        borderWidth: 0
                      }]
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: {
                          position: 'bottom',
                          labels: { padding: 20 }
                        }
                      },
                      cutout: '60%'
                    }
                  });
                </script>